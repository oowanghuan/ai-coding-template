# 02_ARCHITECTURE.md
# {项目名} - 技术架构设计

> 版本：v0.1
> 架构师：{architect_name}
> 最后更新：{date}
> 状态：Draft

---

## 1. 系统架构概览

### 1.1 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        系统架构图                            │
│                                                              │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐              │
│  │  前端    │───▶│  后端    │───▶│  数据层  │              │
│  └──────────┘    └──────────┘    └──────────┘              │
│                                                              │
│  {请替换为实际架构图}                                        │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 核心组件

| 组件 | 职责 | 技术选型 | 部署方式 |
|------|------|----------|----------|
| Web 前端 | 用户界面 | {Vue/React/...} | {Vercel/Nginx/...} |
| API 服务 | 业务逻辑 | {Node/Python/...} | {Docker/K8s/...} |
| 数据库 | 数据存储 | {PostgreSQL/MySQL/...} | {RDS/自建/...} |
| 缓存 | 性能优化 | {Redis/Memcached/...} | {ElastiCache/...} |

### 1.3 设计原则

- **原则 1**：{例如：前后端分离}
- **原则 2**：{例如：API First}
- **原则 3**：{例如：无状态服务}

---

## 2. 系统边界（Phase 0 必填）

> **重要**：此章节定义系统的「冻结边界」，一旦确定，feature 阶段不可侵蚀。

### 2.1 系统边界内（In Scope）

| 能力 | 说明 | 由哪个模块负责 |
|------|------|----------------|
| {能力1} | {说明} | M001 |
| {能力2} | {说明} | M002 |
| {能力3} | {说明} | M003 |

### 2.2 系统边界外（Out of Scope）

> 以下能力**永远不在本系统内**实现，必须通过外部系统调用。

| 能力 | 外部系统 | 集成方式 |
|------|----------|----------|
| {能力1} | {外部系统名} | {API/SDK/...} |
| {能力2} | {外部系统名} | {API/SDK/...} |

### 2.3 明确不做（Won't Build）

> 以下能力**即使技术上可行，本期也不实现**。

| 能力 | 不做原因 | 未来计划 |
|------|----------|----------|
| {能力1} | {原因} | {v2.0 考虑 / 永不} |
| {能力2} | {原因} | {v2.0 考虑 / 永不} |

---

## 3. 模块责任边界（Phase 0 必填）

> **重要**：明确每个模块「只负责什么」和「绝不负责什么」，防止边界侵蚀。

### 3.1 责任矩阵

| 模块 | 只负责 | 绝不负责 |
|------|--------|----------|
| M001 user-auth | 用户身份验证、Token 管理 | 用户资料存储、权限策略 |
| M002 user-profile | 用户资料 CRUD | 身份验证、登录态 |
| M003 {name} | {只负责} | {绝不负责} |

### 3.2 模块间契约

| 调用方 | 被调用方 | 契约接口 | 说明 |
|--------|----------|----------|------|
| M002 | M001 | `getCurrentUser()` | 获取当前登录用户 |
| M003 | M001 | `verifyToken(token)` | 验证 Token 有效性 |
| {caller} | {callee} | {interface} | {说明} |

---

## 4. 关键数据流（Phase 0 必填）

> **重要**：至少定义 2 条核心数据流，作为系统「骨架」冻结。

### 4.1 核心用户流程：{流程名称}

```
用户操作：{例如：用户登录}

┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  用户    │───▶│  前端    │───▶│  API     │───▶│  数据库  │
│  操作    │    │  页面    │    │  服务    │    │          │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
     │               │               │               │
     │  1.输入凭证   │  2.POST /login│  3.验证密码   │
     │               │               │               │
     │               │◀──────────────│◀──────────────│
     │               │  4.返回Token  │  查询用户     │
     │◀──────────────│               │               │
     │  5.跳转首页   │               │               │
```

**关键节点**：
1. {节点1}：{说明}
2. {节点2}：{说明}

### 4.2 核心系统流程：{流程名称}

```
系统操作：{例如：订单创建}

{请绘制数据流图}
```

**关键节点**：
1. {节点1}：{说明}
2. {节点2}：{说明}

---

## 5. 前端架构

### 5.1 技术栈

| 类型 | 选型 | 版本 | 说明 |
|------|------|------|------|
| 框架 | {Vue 3 / React 18 / ...} | {version} | {选型理由} |
| UI 库 | {Element Plus / Ant Design / ...} | {version} | {选型理由} |
| 状态管理 | {Pinia / Redux / Zustand / ...} | {version} | {选型理由} |
| 路由 | {Vue Router / React Router / ...} | {version} | - |
| 构建工具 | {Vite / Webpack / ...} | {version} | - |
| 包管理 | {pnpm / npm / yarn} | - | - |

### 5.2 目录结构

```
src/
├── assets/          # 静态资源
├── components/      # 通用组件
│   ├── common/      # 基础组件
│   └── business/    # 业务组件
├── composables/     # 组合式函数 (Vue) / hooks (React)
├── layouts/         # 布局组件
├── pages/           # 页面组件
│   └── {module}/    # 按模块组织
├── router/          # 路由配置
├── stores/          # 状态管理
├── services/        # API 调用
├── types/           # TypeScript 类型
└── utils/           # 工具函数
```

### 5.3 关键设计决策

| 决策 | 方案 | 理由 |
|------|------|------|
| 组件设计 | {Composition API / Hooks} | {理由} |
| 样式方案 | {CSS Modules / Tailwind / ...} | {理由} |
| 请求处理 | {Axios / Fetch / ...} | {理由} |

---

## 6. 后端架构

### 6.1 技术栈

| 类型 | 选型 | 版本 | 说明 |
|------|------|------|------|
| 语言 | {TypeScript / Python / Go / ...} | {version} | {选型理由} |
| 框架 | {NestJS / FastAPI / Gin / ...} | {version} | {选型理由} |
| ORM | {Prisma / SQLAlchemy / GORM / ...} | {version} | {选型理由} |
| 数据库 | {PostgreSQL / MySQL / ...} | {version} | {选型理由} |
| 缓存 | {Redis / ...} | {version} | {使用场景} |

### 6.2 服务划分

```
后端服务架构：

┌─────────────────────────────────────────┐
│              API Gateway                │
└─────────────────────────────────────────┘
                    │
        ┌───────────┼───────────┐
        ▼           ▼           ▼
┌──────────┐ ┌──────────┐ ┌──────────┐
│ 用户服务  │ │ 业务服务  │ │ 通知服务  │
└──────────┘ └──────────┘ └──────────┘
        │           │           │
        └───────────┼───────────┘
                    ▼
            ┌──────────────┐
            │   数据库     │
            └──────────────┘
```

### 6.3 API 设计原则

- **风格**：{RESTful / GraphQL / gRPC}
- **版本控制**：{URL 路径 /api/v1/ / Header}
- **认证方式**：{JWT / Session / OAuth2}
- **错误处理**：{统一错误码格式}

### 6.4 数据库设计原则

- **命名规范**：{snake_case / camelCase}
- **主键策略**：{UUID / 自增 ID / Snowflake}
- **软删除**：{是否启用，字段名}
- **审计字段**：{created_at, updated_at, created_by, ...}

---

## 7. 基础设施

### 7.1 部署架构

```
部署架构图：

┌─────────────────────────────────────────────────────────────┐
│                         CDN                                  │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                    Load Balancer                             │
└─────────────────────────────────────────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            ▼               ▼               ▼
      ┌──────────┐   ┌──────────┐   ┌──────────┐
      │ Server 1 │   │ Server 2 │   │ Server N │
      └──────────┘   └──────────┘   └──────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                    Database Cluster                          │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 环境规划

| 环境 | 用途 | 域名 | 基础设施 |
|------|------|------|----------|
| Development | 本地开发 | localhost | Docker Compose |
| Staging | 测试验证 | staging.{domain} | {云服务商} |
| Production | 正式环境 | {domain} | {云服务商} |

### 7.3 CI/CD 流程

```
代码提交 → 代码检查 → 单元测试 → 构建 → 部署 Staging → E2E 测试 → 部署 Production
```

### 7.4 监控与日志

| 类型 | 工具 | 说明 |
|------|------|------|
| 应用监控 | {Sentry / Datadog / ...} | 错误追踪、性能监控 |
| 日志收集 | {ELK / CloudWatch / ...} | 日志聚合、检索 |
| 指标监控 | {Prometheus + Grafana / ...} | 系统指标、业务指标 |
| 告警 | {PagerDuty / 企业微信 / ...} | 异常告警通知 |

---

## 8. 安全设计

### 8.1 认证与授权

| 方面 | 方案 | 说明 |
|------|------|------|
| 用户认证 | {JWT / Session / OAuth2} | {详细说明} |
| 权限模型 | {RBAC / ABAC / ...} | {详细说明} |
| Token 管理 | {过期时间、刷新机制} | {详细说明} |

### 8.2 数据安全

| 方面 | 措施 |
|------|------|
| 传输加密 | HTTPS / TLS 1.3 |
| 敏感数据加密 | {加密算法、密钥管理} |
| 数据备份 | {备份策略、恢复流程} |
| 访问控制 | {最小权限原则} |

### 8.3 安全实践

- [ ] SQL 注入防护
- [ ] XSS 防护
- [ ] CSRF 防护
- [ ] 敏感信息脱敏
- [ ] 安全审计日志

---

## 9. 性能设计

### 9.1 性能目标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 页面首屏加载 | < 2s | P90 |
| API 响应时间 | < 200ms | P90 |
| 并发用户数 | {N} | 预期峰值 |
| 可用性 | 99.9% | SLA |

### 9.2 优化策略

| 层级 | 策略 |
|------|------|
| 前端 | CDN、代码分割、懒加载、缓存策略 |
| 后端 | 连接池、缓存、异步处理、限流 |
| 数据库 | 索引优化、读写分离、分库分表 |

---

## 10. 扩展性设计

### 10.1 水平扩展

- 无状态服务设计
- 负载均衡策略
- 数据库分片策略

### 10.2 垂直扩展

- 服务拆分边界
- 微服务演进路径

---

## CHANGELOG

| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| v0.1 | {date} | {author} | 初始版本 |
