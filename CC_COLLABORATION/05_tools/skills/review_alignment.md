# review_alignment - 设计一致性检查

> 类型：Skill（自动触发）
> 版本：v2.0
> 最后更新：2026-01-09

---

## 何时自动使用

Claude 应该在以下情况**自动应用**这个 skill：

- 完成一个编码任务后，自动检查代码是否符合设计文档
- 用户说「检查下代码和设计是否一致」「review 下实现」
- 用户说「这个功能写完了」，且存在对应的 DESIGN 文档
- 在 Phase 5 Code 阶段，提交代码前的自检

**不适用场景**：
- 还没有 DESIGN 文档（Phase 4 之前）
- 用户明确说不需要检查

---

## 执行方式

### 1. 定位设计文档

```
设计文档: docs/{feature}/40_DESIGN_FINAL.md
```

### 2. 提取设计要点

从 DESIGN 文档中提取：
- 架构决策（技术选型、模式选择）
- 接口定义（API 签名、参数、返回值）
- 数据结构（模型字段、类型）
- 关键约束（性能、安全、边界条件）

### 3. 扫描实现代码

对比设计要点，检查：

| 检查项 | 检查方式 |
|--------|----------|
| API 路径 | 代码中的路由是否与设计一致 |
| 参数名称 | 函数参数是否与设计一致 |
| 返回结构 | 返回的 JSON 结构是否与设计一致 |
| 错误处理 | 是否实现了设计中的错误码 |
| 数据模型 | 字段名、类型是否与设计一致 |

### 4. 输出检查报告

```markdown
## 设计一致性检查报告

### 检查范围
- 设计文档: docs/{feature}/40_DESIGN_FINAL.md
- 代码文件: src/...

### 检查结果

#### ✅ 一致项
- API 路径 `/api/auth/login` 与设计一致
- 用户模型字段与设计一致

#### ⚠️ 差异项
- 设计: `created_at: datetime`
- 实现: `createdAt: string`
- 建议: 统一使用 snake_case

#### ❌ 缺失项
- 设计中的 `POST /api/auth/refresh` 未实现
```

---

## 示例对话

### 示例 1：任务完成后自动检查

**User**: 登录功能写完了

**Claude**: [自动应用 review_alignment skill]

好的，我来检查下代码和设计文档的一致性。

正在读取 `docs/user-auth/40_DESIGN_FINAL.md`...
正在扫描 `src/auth/` 目录下的实现代码...

**检查结果**：

✅ **一致项（8/10）**
- API 路径正确
- 请求参数正确
- 返回结构正确
- 错误码实现完整

⚠️ **差异项（2/10）**
1. 字段命名风格不一致
   - 设计: `access_token`
   - 实现: `accessToken`

2. 响应状态码
   - 设计: 401 Unauthorized
   - 实现: 400 Bad Request

建议修复这两个差异后再进入测试阶段。需要我帮你修改吗？

### 示例 2：主动要求检查

**User**: 帮我 review 下 user-auth 的实现和设计是否对得上

**Claude**: [自动应用 review_alignment skill]

我来对比 user-auth 的设计文档和实现代码...

[执行检查并输出报告]

---

## 检查清单

### API 层面
- [ ] 路径是否一致
- [ ] HTTP 方法是否一致
- [ ] 请求参数名称和类型是否一致
- [ ] 响应结构是否一致
- [ ] 错误码是否一致

### 数据层面
- [ ] 模型字段名称是否一致
- [ ] 字段类型是否一致
- [ ] 必填/可选属性是否一致
- [ ] 默认值是否一致

### 业务逻辑
- [ ] 关键流程是否按设计实现
- [ ] 边界条件处理是否完整
- [ ] 安全约束是否落实

---

## 注意事项

1. **设计优先**：以设计文档为准，代码应该符合设计
2. **命名一致**：注意 camelCase vs snake_case 的一致性
3. **类型严格**：检查类型定义是否匹配
4. **记录差异**：差异项应该记录到 REVIEW_ACTIONS.yaml

---

_CC_COLLABORATION Framework v3.1_
