# /start-day - 每日开始工作

你是一个 AI 协作开发助手。用户请求开始今天的工作，需要同步远程仓库并恢复上下文。

## 触发方式

用户可以通过以下方式触发：
- `/start-day` 或 `/start-day <feature>`
- "开始工作"
- "早上好"
- "我来了"

## 参数

- `$ARGUMENTS`：可选，功能模块名称（如 `user-auth`）。如未指定，自动检测最近活跃的功能。

## 执行步骤

### 1. 显示欢迎信息

```
🌅 早上好！让我们开始今天的工作。

正在同步和恢复工作上下文...
```

### 2. 执行 Git Pull

首先同步远程仓库的最新代码：

```bash
git pull origin <当前分支>
```

**输出处理**：
- ✅ 成功：显示更新的文件列表
- ⚠️ 有冲突：提示用户需要先解决冲突
- ℹ️ 已是最新：继续下一步

示例输出：
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📥 Git 同步
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
分支: main
状态: ✅ 已同步最新代码

更新的文件：
• docs/user-auth/30_PROGRESS_LOG.yaml (modified)
• src/auth/login.vue (modified)
```

### 3. 检测功能模块

如果未指定功能模块，自动检测：

1. 扫描 `docs/` 目录下所有功能模块
2. 读取每个模块的 `30_PROGRESS_LOG.yaml`
3. 按 `last_updated` 排序，找出最近活跃的模块
4. 如果有多个活跃模块，列出供用户选择

```
检测到以下活跃功能模块：
1. user-auth (最后更新: 今天 18:30)
2. payment-system (最后更新: 昨天 17:45)

请选择要恢复的功能，或输入 "all" 查看全局进度。
```

### 4. 执行 /iresume

调用 `/iresume <feature>` 恢复工作上下文。

### 5. 显示今日待办

从 PROGRESS_LOG 中提取待办事项：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 今日待办
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏭️ 下一步: {next_step}

🔄 进行中 ({wip_count}):
{列出进行中的任务}

⏳ 今日计划 ({pending_count} 待开始):
{列出建议今天完成的任务}
```

### 6. 输出完整摘要

```
🌅 每日开始 - {feature-name}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📥 Git 同步
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
分支: {branch}
状态: {sync_status}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 上下文恢复
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 功能模块: {feature-name}
• 当前阶段: Phase {phase} - {phase_name}
• 整体进度: {completion_rate}
• 上次操作: {last_action}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 今日待办
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏭️ 下一步: {next_step}

🔄 进行中:
{列出进行中的任务}

⏳ 建议完成:
{列出建议今天完成的任务}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 准备就绪！可以开始工作了。

💡 提示：
• 下班前记得运行 /end-day 更新进度并提交代码
• 随时使用 /check-progress 查看当前状态
```

## 输出示例

```
🌅 每日开始 - user-auth

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📥 Git 同步
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
分支: main
状态: ✅ 已同步最新代码 (2 files updated)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 上下文恢复
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 功能模块: user-auth
• 当前阶段: Phase 5 - Code（开发实现）
• 整体进度: 45%
• 上次操作: 完成登录表单 UI

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 今日待办
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏭️ 下一步: 实现登录 API 调用

🔄 进行中 (1):
• [CODE-004] 实现登录 API 调用

⏳ 建议完成 (2):
• [CODE-005] 实现 Token 存储
• [CODE-006] 添加登录状态管理

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 准备就绪！可以开始工作了。

💡 提示：
• 下班前记得运行 /end-day 更新进度并提交代码
• 随时使用 /check-progress 查看当前状态
```

## 冲突处理

如果 git pull 检测到冲突：

```
⚠️ Git 同步时发现冲突

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
冲突文件:
• src/auth/login.vue
• docs/user-auth/30_PROGRESS_LOG.yaml
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请先解决冲突后再继续：
1. 查看冲突: git diff
2. 解决冲突后: git add <文件>
3. 完成合并: git commit

解决完成后，重新运行 /start-day
```

## 注意事项

- 自动检测当前 Git 分支
- 如果不在 Git 仓库中，跳过 git pull 步骤
- 优先显示进行中（wip）的任务
- 建议完成的任务按优先级排序（P0 > P1 > P2 > P3）
- 更新 `cc_checkpoint.session_id` 为今日新 session
