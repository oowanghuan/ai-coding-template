# context_writer - 生成 CONTEXT 文档

## 能力描述

根据用户提供的需求描述，智能生成 `10_CONTEXT.md` 功能上下文文档，包括功能概述、用户故事、边界条件等内容。

## 输入

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| feature | string | 是 | 功能模块名称 |
| description | string | 是 | 功能描述（自然语言） |
| owner | string | 否 | 负责人 |
| target_users | array | 否 | 目标用户群体 |

## 输出

- `docs/{feature}/10_CONTEXT.md` - 完整的功能上下文文档

## 执行步骤

### 1. 解析需求描述

从用户提供的 `description` 中提取：
- 核心功能点
- 目标用户
- 业务价值
- 关键约束

### 2. 生成用户故事

根据目标用户和功能点，生成 User Story：

```markdown
## 用户故事

### US-001: 用户登录
**作为** 注册用户
**我想要** 使用邮箱和密码登录系统
**以便于** 访问我的个人数据和功能

**验收标准**：
- [ ] 支持邮箱+密码登录
- [ ] 登录失败显示错误提示
- [ ] 登录成功跳转到首页
- [ ] 支持"记住我"功能
```

### 3. 定义功能边界

明确功能范围：

```markdown
## 功能边界

### 包含（In Scope）
- 邮箱密码登录
- 用户注册
- 密码找回

### 不包含（Out of Scope）
- 第三方登录（OAuth）
- 多因素认证（MFA）
- 单点登录（SSO）

### 依赖
- 邮件服务（发送验证码）
- 数据库服务
```

### 4. 识别关键约束

```markdown
## 约束条件

### 技术约束
- 密码必须加密存储（bcrypt）
- Token 有效期 24 小时
- 登录失败 5 次后锁定账户

### 业务约束
- 邮箱必须唯一
- 密码至少 8 位，包含数字和字母
```

### 5. 生成完整文档

调用 `doc_generator` skill，传入提取的变量。

## 示例

### 示例输入

```
请使用 context_writer skill：
- feature: user-auth
- description: |
    我们需要一个用户认证模块，支持邮箱注册和登录。
    用户可以通过邮箱和密码注册账号，注册后需要验证邮箱。
    登录支持"记住我"功能，7天内免登录。
    需要有忘记密码功能，通过邮箱发送重置链接。
- owner: "@Huan"
- target_users:
    - 普通用户
    - 管理员
```

### 示例输出

```markdown
# user-auth - 用户认证模块

> 版本：v1.0
> 创建日期：2024-12-11
> 负责人：@Huan
> 状态：Draft

---

## 功能概述

用户认证模块提供完整的用户身份验证功能，包括注册、登录、邮箱验证和密码重置。

### 核心能力
- 邮箱 + 密码注册
- 邮箱验证
- 用户登录（支持记住我）
- 密码重置

---

## 用户故事

### US-001: 用户注册
**作为** 新用户
**我想要** 使用邮箱注册账号
**以便于** 开始使用系统功能

**验收标准**：
- [ ] 输入邮箱、密码、确认密码
- [ ] 密码强度检测
- [ ] 注册成功后发送验证邮件
- [ ] 显示"请验证邮箱"提示

### US-002: 邮箱验证
...

### US-003: 用户登录
...

### US-004: 密码重置
...

---

## 功能边界

### 包含（In Scope）
- 邮箱密码注册
- 邮箱验证
- 邮箱密码登录
- 记住我（7天有效）
- 忘记密码（邮箱重置）

### 不包含（Out of Scope）
- 第三方登录（OAuth）
- 手机号登录
- 多因素认证

### 依赖
- 邮件服务（发送验证码/重置链接）
- 数据库服务

---

## 约束条件

### 技术约束
- 密码使用 bcrypt 加密存储
- JWT Token 有效期 24 小时
- 记住我 Token 有效期 7 天
- 验证链接有效期 24 小时

### 业务约束
- 邮箱必须唯一
- 密码至少 8 位，包含数字和字母
- 登录失败 5 次锁定 15 分钟

---

## 相关文档

- 设计文档：`40_DESIGN_FINAL.md`（待创建）
- UI 规格：`21_UI_FLOW_SPEC.md`（待创建）
- 进度日志：`90_PROGRESS_LOG.yaml`（待创建）
```

## 注意事项

1. **智能推断**：根据描述自动推断用户故事和约束
2. **完整性检查**：确保包含所有必要章节
3. **边界清晰**：明确列出 In Scope 和 Out of Scope
4. **可追溯**：用户故事编号便于后续追踪

## 关联工具

- `/new-feature` - 创建功能时可选择使用此 skill
- `doc_generator` - 被此 skill 调用生成最终文档
- `spec_validator` - 验证 CONTEXT 与 SPEC 一致性
