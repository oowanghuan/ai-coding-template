# test_runner - æ‰§è¡Œæµ‹è¯•

## èƒ½åŠ›æè¿°

æ ¹æ® `60_TEST_PLAN.md` æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæ”¯æŒå¤šç§æµ‹è¯•ç±»å‹ï¼š
- UI æµ‹è¯•ï¼ˆé€šè¿‡ Chrome MCPï¼‰
- API æµ‹è¯•
- å•å…ƒæµ‹è¯•ï¼ˆé€šè¿‡ Vitest/Jestï¼‰

## è¾“å…¥

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| feature | string | æ˜¯ | åŠŸèƒ½æ¨¡å—åç§° |
| test_type | string | å¦ | æµ‹è¯•ç±»å‹ï¼š`all`, `ui`, `api`, `unit`ï¼Œé»˜è®¤ `all` |
| test_ids | array | å¦ | æŒ‡å®šæµ‹è¯•ç”¨ä¾‹ IDï¼Œä¸æŒ‡å®šåˆ™æ‰§è¡Œå…¨éƒ¨ |
| headless | boolean | å¦ | æ˜¯å¦æ— å¤´æ¨¡å¼ï¼ˆUI æµ‹è¯•ï¼‰ï¼Œé»˜è®¤ true |

## è¾“å‡º

- æµ‹è¯•æ‰§è¡Œç»“æœ
- å¤±è´¥ç”¨ä¾‹è¯¦æƒ…
- æˆªå›¾/æ—¥å¿—ï¼ˆUI æµ‹è¯•ï¼‰

## æ‰§è¡Œæ­¥éª¤

### 1. è¯»å–æµ‹è¯•è®¡åˆ’

```
è¯»å–ï¼šdocs/{feature}/60_TEST_PLAN.md
æå–æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨
```

### 2. å‡†å¤‡æµ‹è¯•ç¯å¢ƒ

```yaml
# æ ¹æ®æµ‹è¯•ç±»å‹å‡†å¤‡ç¯å¢ƒ
ui_test:
  - ç¡®ä¿å¼€å‘æœåŠ¡å™¨è¿è¡Œ
  - åˆå§‹åŒ– Chrome MCP è¿æ¥
  - è®¾ç½®è§†å£å¤§å°

api_test:
  - ç¡®ä¿ API æœåŠ¡è¿è¡Œ
  - å‡†å¤‡æµ‹è¯•æ•°æ®

unit_test:
  - ç¡®ä¿ä¾èµ–å®‰è£…
  - å‡†å¤‡ mock æ•°æ®
```

### 3. æ‰§è¡Œæµ‹è¯•

#### UI æµ‹è¯•æ‰§è¡Œ

ä½¿ç”¨ Chrome MCP å·¥å…·æ‰§è¡Œï¼š

```javascript
// æµ‹è¯•ç”¨ä¾‹: TC-UI-001 ç™»å½•æˆåŠŸ
async function testLoginSuccess() {
  // 1. å¯¼èˆªåˆ°ç™»å½•é¡µ
  await navigate('http://localhost:3000/login')

  // 2. å¡«å†™è¡¨å•
  await fill('#email', 'test@example.com')
  await fill('#password', 'password123')

  // 3. ç‚¹å‡»ç™»å½•
  await click('#login-btn')

  // 4. ç­‰å¾…è·³è½¬
  await waitFor('Dashboard')

  // 5. éªŒè¯ç»“æœ
  const url = await getCurrentUrl()
  assert(url.includes('/dashboard'), 'åº”è·³è½¬åˆ° Dashboard')

  // 6. æˆªå›¾
  await screenshot('login-success.png')
}
```

#### API æµ‹è¯•æ‰§è¡Œ

```javascript
// æµ‹è¯•ç”¨ä¾‹: TC-API-001 ç™»å½•æ¥å£
async function testLoginAPI() {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      email: 'test@example.com',
      password: 'password123'
    })
  })

  const data = await response.json()

  // éªŒè¯
  assert(response.status === 200, 'çŠ¶æ€ç åº”ä¸º 200')
  assert(data.data.token, 'åº”è¿”å› token')
  assert(data.data.user.email === 'test@example.com', 'é‚®ç®±åº”åŒ¹é…')
}
```

#### å•å…ƒæµ‹è¯•æ‰§è¡Œ

```bash
# æ‰§è¡Œ Vitest
npx vitest run --reporter=json --outputFile=test-results.json
```

### 4. å¤±è´¥å¤„ç†ç­–ç•¥

**æ ¸å¿ƒåŸåˆ™**ï¼šå…ˆå®Œæˆå…¨éƒ¨æµ‹è¯•ï¼Œè®°å½•æ‰€æœ‰é—®é¢˜ï¼Œå†ç»Ÿä¸€ä¿®å¤ï¼ˆP0/P1 ä¾‹å¤–ï¼‰ã€‚

#### é—®é¢˜åˆ†çº§æ ‡å‡†

| çº§åˆ« | å®šä¹‰ | å¤„ç†æ–¹å¼ | ç¤ºä¾‹ |
|------|------|----------|------|
| P0 | åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨ | **ç«‹å³ä¿®å¤** | é¡µé¢ç™½å±ã€ç™»å½•å´©æºƒ |
| P1 | æ ¸å¿ƒæµç¨‹å—é˜» | **ç«‹å³ä¿®å¤** | æ— æ³•æäº¤è¡¨å•ã€è·³è½¬é”™è¯¯ |
| P2 | åŠŸèƒ½å¼‚å¸¸ä½†å¯ç»•è¿‡ | è®°å½•ï¼Œåç»­ä¿®å¤ | é”™è¯¯æç¤ºä¸å‡†ç¡®ã€æ ·å¼é”™ä½ |
| P3 | ä½“éªŒé—®é¢˜ | è®°å½•ï¼Œåç»­ä¿®å¤ | æŒ‰é’®ä½ç½®ä¸ç†æƒ³ã€æ–‡æ¡ˆä¸æ¸…æ™° |

#### å¤±è´¥å¤„ç†æµç¨‹

```
æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€šè¿‡ï¼Ÿ  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
 Yes â”‚    No
     â†“     â†“
 è®°å½• âœ…   åˆ¤æ–­ä¸¥é‡ç¨‹åº¦
           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
   â”‚               â”‚
 P0/P1          P2/P3
(é˜»å¡æ€§)       (éé˜»å¡)
   â”‚               â”‚
   â†“               â†“
æš‚åœæµ‹è¯•       è®°å½•é—®é¢˜ âŒ
ç«‹å³ä¿®å¤       ç»§ç»­ä¸‹ä¸€ä¸ªç”¨ä¾‹
é‡è·‘å½“å‰ç”¨ä¾‹
   â”‚               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
     å…¨éƒ¨ç”¨ä¾‹æ‰§è¡Œå®Œæ¯•
           â†“
     ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
           â†“
     ç»Ÿä¸€ä¿®å¤ P2/P3 é—®é¢˜
           â†“
     å›å½’æµ‹è¯•
```

#### åˆ†çº§åˆ¤å®šé€»è¾‘

```javascript
function classifyFailure(error, testCase) {
  // P0: é¡µé¢/æœåŠ¡å®Œå…¨ä¸å¯ç”¨
  if (error.type === 'PAGE_CRASH' ||
      error.type === 'SERVICE_UNAVAILABLE' ||
      error.message.includes('ç™½å±') ||
      error.message.includes('Cannot read property')) {
    return 'P0';
  }

  // P1: æ ¸å¿ƒæµç¨‹é˜»å¡
  if (testCase.priority === 'P0' ||
      error.type === 'NAVIGATION_FAILED' ||
      error.type === 'FORM_SUBMIT_FAILED') {
    return 'P1';
  }

  // P2: åŠŸèƒ½å¼‚å¸¸ä½†å¯ç»•è¿‡
  if (error.type === 'ASSERTION_FAILED' ||
      error.type === 'ELEMENT_NOT_FOUND') {
    return 'P2';
  }

  // P3: ä½“éªŒé—®é¢˜
  return 'P3';
}
```

### 5. æ”¶é›†ç»“æœ

```yaml
test_results:
  summary:
    total: 15
    passed: 13
    failed: 2
    skipped: 0
    duration: "45.2s"

  passed:
    - id: TC-UI-001
      name: "ç™»å½•æˆåŠŸ"
      duration: "2.3s"
    # ...

  failed:
    - id: TC-UI-005
      name: "å¯†ç é”™è¯¯æç¤º"
      severity: P2                                    # æ–°å¢ï¼šé—®é¢˜çº§åˆ«
      error: "æ–­è¨€å¤±è´¥ï¼šæœªæ‰¾åˆ°é”™è¯¯æç¤ºå…ƒç´ "
      screenshot: "screenshots/TC-UI-005-failed.png"
      expected: "æ˜¾ç¤º'å¯†ç é”™è¯¯'æç¤º"
      actual: "é¡µé¢æ— å˜åŒ–"
      handled: "recorded"                             # æ–°å¢ï¼šå¤„ç†æ–¹å¼
    # ...
```

### 6. è¾“å‡ºç»“æœ

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§ª æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åŠŸèƒ½ï¼š{feature}
æ—¶é—´ï¼š{datetime}
ç±»å‹ï¼š{test_type}
è€—æ—¶ï¼š45.2s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æµ‹è¯•ç»“æœæ‘˜è¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  æ€»è®¡: 15
  âœ… é€šè¿‡: 13 (86.7%)
  âŒ å¤±è´¥: 2
  â­ï¸ è·³è¿‡: 0

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ å¤±è´¥ç”¨ä¾‹è¯¦æƒ…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. TC-UI-005: å¯†ç é”™è¯¯æç¤º
   ç±»å‹: UI
   é”™è¯¯: æ–­è¨€å¤±è´¥ - æœªæ‰¾åˆ°é”™è¯¯æç¤ºå…ƒç´ 
   é¢„æœŸ: æ˜¾ç¤º"å¯†ç é”™è¯¯"æç¤º
   å®é™…: é¡µé¢æ— å˜åŒ–
   æˆªå›¾: screenshots/TC-UI-005-failed.png

   å¯èƒ½åŸå› :
   â€¢ é”™è¯¯æç¤ºå…ƒç´ é€‰æ‹©å™¨å˜æ›´
   â€¢ é”™è¯¯çŠ¶æ€æœªæ­£ç¡®è§¦å‘

   å»ºè®®:
   â€¢ æ£€æŸ¥ LoginPage.vue çš„é”™è¯¯æç¤ºé€»è¾‘
   â€¢ ç¡®è®¤ API è¿”å›æ­£ç¡®çš„é”™è¯¯ç 

2. TC-API-003: æ³¨å†Œé‚®ç®±é‡å¤
   ç±»å‹: API
   é”™è¯¯: çŠ¶æ€ç ä¸åŒ¹é…
   é¢„æœŸ: 409
   å®é™…: 500

   å»ºè®®:
   â€¢ æ£€æŸ¥åç«¯é‡å¤é‚®ç®±çš„å¤„ç†é€»è¾‘

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ ä¸‹ä¸€æ­¥:
1. ä¿®å¤ 2 ä¸ªå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹
2. è¿è¡Œ /run-tests {feature} é‡æ–°æµ‹è¯•
3. å…¨éƒ¨é€šè¿‡åä½¿ç”¨ test_report_generator ç”ŸæˆæŠ¥å‘Š
```

## ç¤ºä¾‹

### ç¤ºä¾‹è¾“å…¥

```
è¯·ä½¿ç”¨ test_runner skillï¼š
- feature: user-auth
- test_type: ui
- headless: false
```

### ç¤ºä¾‹è¾“å‡º

åœ¨å¯è§†åŒ–æ¨¡å¼ä¸‹æ‰§è¡Œ UI æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ“ä½œè¿‡ç¨‹ã€‚

## æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒä¾èµ–**ï¼šç¡®ä¿æµ‹è¯•ç¯å¢ƒï¼ˆæœåŠ¡å™¨ã€æ•°æ®åº“ï¼‰å·²å‡†å¤‡
2. **æµ‹è¯•éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åº”ç‹¬ç«‹ï¼Œä¸ä¾èµ–å…¶ä»–ç”¨ä¾‹çš„çŠ¶æ€
3. **æ•°æ®æ¸…ç†**ï¼šæµ‹è¯•åæ¸…ç†åˆ›å»ºçš„æµ‹è¯•æ•°æ®
4. **è¶…æ—¶è®¾ç½®**ï¼šUI æµ‹è¯•è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
5. **æˆªå›¾ä¿å­˜**ï¼šå¤±è´¥ç”¨ä¾‹è‡ªåŠ¨ä¿å­˜æˆªå›¾

## å…³è”å·¥å…·

- `/run-tests` - Slash Command å°è£…
- `test_plan_writer` - ç”Ÿæˆæµ‹è¯•è®¡åˆ’
- `test_report_generator` - ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
