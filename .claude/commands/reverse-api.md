# /reverse-api - ä»ä»£ç é€†å‘ç”Ÿæˆ API æ–‡æ¡£

ä½ æ˜¯ä¸€ä¸ª AI åä½œå¼€å‘åŠ©æ‰‹ã€‚ç”¨æˆ·è¯·æ±‚ä»ç°æœ‰ä»£ç é€†å‘ç”Ÿæˆ API æ–‡æ¡£ã€‚

## å‚æ•°

- `$ARGUMENTS`ï¼šé¡¹ç›®è·¯å¾„å’Œé€‰é¡¹
  - `--output=PATH`ï¼šè¾“å‡ºè·¯å¾„ï¼ˆé»˜è®¤ docs/{project}/20_API_SPEC.mdï¼‰
  - `--format=FORMAT`ï¼šè¾“å‡ºæ ¼å¼ï¼ˆmarkdown | openapiï¼Œé»˜è®¤ markdownï¼‰
  - `--framework=NAME`ï¼šæŒ‡å®šæ¡†æ¶ï¼ˆè‡ªåŠ¨æ£€æµ‹æˆ–æ‰‹åŠ¨æŒ‡å®šï¼‰

## ç”¨æ³•

```
/reverse-api ./my-backend
/reverse-api ./my-backend --format=openapi
/reverse-api ./my-backend --framework=express
```

## æ”¯æŒçš„æ¡†æ¶

| æ¡†æ¶ | è·¯ç”±æ£€æµ‹æ–¹å¼ | æ”¯æŒç¨‹åº¦ |
|------|-------------|----------|
| Express | `app.get/post/...` æˆ– `router.get/post/...` | âœ… å®Œæ•´ |
| Koa | `router.get/post/...` | âœ… å®Œæ•´ |
| NestJS | `@Get/@Post/...` è£…é¥°å™¨ | âœ… å®Œæ•´ |
| Fastify | `fastify.get/post/...` | âš ï¸ åŸºç¡€ |
| Hono | `app.get/post/...` | âš ï¸ åŸºç¡€ |

## æ‰§è¡Œæ­¥éª¤

### 1. æ£€æµ‹æ¡†æ¶ç±»å‹

```
è¯»å– package.json æ£€æµ‹ï¼š
  - express â†’ Express
  - koa + @koa/router â†’ Koa
  - @nestjs/core â†’ NestJS
  - fastify â†’ Fastify
  - hono â†’ Hono

å¦‚æœæ— æ³•æ£€æµ‹ï¼š
  æç¤ºç”¨æˆ·ä½¿ç”¨ --framework æŒ‡å®š
```

### 2. å®šä½è·¯ç”±æ–‡ä»¶

```
æ ¹æ®æ¡†æ¶ç±»å‹æŸ¥æ‰¾è·¯ç”±æ–‡ä»¶ï¼š

Express/Koa:
  - src/routes/**/*.{js,ts}
  - src/router/**/*.{js,ts}
  - routes/**/*.{js,ts}
  - app.{js,ts}ï¼ˆåŒ…å«è·¯ç”±å®šä¹‰ï¼‰

NestJS:
  - src/**/*.controller.ts
  - src/**/*.controller.js

é€šç”¨æ¨¡å¼:
  - æŸ¥æ‰¾åŒ…å« router/route/controller çš„æ–‡ä»¶
```

### 3. è§£æè·¯ç”±å®šä¹‰

```
å¯¹æ¯ä¸ªè·¯ç”±æ–‡ä»¶ï¼Œæå–ï¼š

route_info:
  method: GET | POST | PUT | DELETE | PATCH
  path: "/api/users/:id"
  handler: "getUserById"
  file: "src/routes/user.ts"
  line: 42

# å°è¯•æ¨æ–­æ›´å¤šä¿¡æ¯
  params: [{name: "id", type: "string", in: "path"}]
  query: [{name: "page", type: "number", in: "query"}]
  body: {æ¨æ–­è‡ª TypeScript ç±»å‹æˆ– Zod schema}
  response: {æ¨æ–­è‡ªè¿”å›ç±»å‹}
```

### 4. æå–è¯·æ±‚/å“åº”ç±»å‹

```
å¦‚æœæ˜¯ TypeScript é¡¹ç›®ï¼š
  æŸ¥æ‰¾ç›¸å…³ç±»å‹å®šä¹‰ï¼š
    - å‡½æ•°å‚æ•°ç±»å‹
    - req.body çš„ç±»å‹
    - è¿”å›å€¼ç±»å‹

å¦‚æœæœ‰ Zod/Joi éªŒè¯ï¼š
  è§£æ schema å®šä¹‰

å¦‚æœæ— æ³•æ¨æ–­ï¼š
  æ ‡è®°ä¸º confidence: low
  æ·»åŠ  TODO: éœ€è¦äººå·¥è¡¥å……
```

### 5. ç”Ÿæˆ API æ–‡æ¡£

#### Markdown æ ¼å¼ï¼ˆé»˜è®¤ï¼‰

```markdown
# 20_API_SPEC.md
# {project_name} - API è§„èŒƒ [é€†å‘]

> ç‰ˆæœ¬ï¼šv0.1
> ç”Ÿæˆæ—¶é—´ï¼š{datetime}
> ç”Ÿæˆæ–¹å¼ï¼š/reverse-api
> çŠ¶æ€ï¼šå¾…éªŒè¯

---

## æ¦‚è¿°

æœ¬æ–‡æ¡£ç”± `/reverse-api` å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆï¼Œå†…å®¹æ ‡è®°ä¸º [é€†å‘]ã€‚
è¯·äººå·¥éªŒè¯åå°†çŠ¶æ€æ”¹ä¸º [å·²éªŒè¯]ã€‚

**ç»Ÿè®¡**ï¼š
- ç«¯ç‚¹æ€»æ•°ï¼š{total_endpoints}
- å·²éªŒè¯ï¼š0
- å¾…éªŒè¯ï¼š{total_endpoints}

---

## API ç«¯ç‚¹åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | æè¿° | éªŒè¯çŠ¶æ€ |
|------|------|------|----------|
{åˆ—å‡ºæ‰€æœ‰ç«¯ç‚¹}

---

## è¯¦ç»†å®šä¹‰

### ç”¨æˆ·æ¨¡å— [é€†å‘]

#### GET /api/users

è·å–ç”¨æˆ·åˆ—è¡¨

**è¯·æ±‚å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | ä½ç½® | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|------|
| page | number | query | å¦ | é¡µç  [æ¨æ–­] |
| limit | number | query | å¦ | æ¯é¡µæ•°é‡ [æ¨æ–­] |

**å“åº”**ï¼š
```json
{
  "users": [...],
  "total": 100
}
```
_[æ¨æ–­] éœ€è¦éªŒè¯_

**æ¥æº**ï¼š`src/routes/user.ts:15`

---

#### GET /api/users/:id

è·å–å•ä¸ªç”¨æˆ·

**è·¯å¾„å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | string | ç”¨æˆ· ID |

**å“åº”**ï¼š
```typescript
// [æ¨æ–­] æ¥è‡ª src/types/user.ts
interface User {
  id: string;
  name: string;
  email: string;
}
```

**æ¥æº**ï¼š`src/routes/user.ts:28`

---

{ç»§ç»­åˆ—å‡ºå…¶ä»–ç«¯ç‚¹...}

---

## éªŒè¯æ¸…å•

ä»¥ä¸‹ç«¯ç‚¹éœ€è¦äººå·¥éªŒè¯ï¼š

- [ ] GET /api/users - å‚æ•°ç±»å‹å¾…ç¡®è®¤
- [ ] POST /api/users - è¯·æ±‚ä½“ç»“æ„å¾…ç¡®è®¤
- [ ] ...

---

## å…ƒæ•°æ®

```yaml
_meta:
  generated_at: "{datetime}"
  generator: "/reverse-api"
  source_files:
    - src/routes/user.ts
    - src/routes/order.ts
  confidence:
    high: 12
    medium: 5
    low: 3
```

---

_Generated by /reverse-api | {datetime}_
```

#### OpenAPI æ ¼å¼

```yaml
openapi: 3.0.0
info:
  title: {project_name} API
  version: 1.0.0
  description: |
    [é€†å‘] ç”± /reverse-api è‡ªåŠ¨ç”Ÿæˆ
    ç”Ÿæˆæ—¶é—´ï¼š{datetime}

paths:
  /api/users:
    get:
      summary: è·å–ç”¨æˆ·åˆ—è¡¨ [é€†å‘]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserListResponse'

# ... æ›´å¤šç«¯ç‚¹

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string

x-reverse-meta:
  generated_at: "{datetime}"
  confidence_scores:
    - path: /api/users
      confidence: 0.8
    - path: /api/users/{id}
      confidence: 0.9
```

### 6. è¾“å‡ºç»“æœ

```
âœ… API æ–‡æ¡£ç”Ÿæˆå®Œæˆï¼

é¡¹ç›®ï¼š{project_name}
æ¡†æ¶ï¼š{framework}
è¾“å‡ºï¼š{output_path}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ç”Ÿæˆç»Ÿè®¡ï¼š
  ç«¯ç‚¹æ€»æ•°ï¼š{total}
  é«˜ç½®ä¿¡åº¦ï¼š{high_confidence} (â‰¥0.8)
  ä¸­ç½®ä¿¡åº¦ï¼š{medium_confidence} (0.5-0.8)
  ä½ç½®ä¿¡åº¦ï¼š{low_confidence} (<0.5)

ğŸ“ åˆ†æçš„æ–‡ä»¶ï¼š
  {åˆ—å‡ºåˆ†æçš„è·¯ç”±æ–‡ä»¶}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ é‡è¦æç¤ºï¼š

  æ‰€æœ‰ç”Ÿæˆçš„å†…å®¹æ ‡è®°ä¸º [é€†å‘]
  è¯·äººå·¥éªŒè¯åæ›´æ–°éªŒè¯çŠ¶æ€

ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œï¼š
  1. æŸ¥çœ‹ç”Ÿæˆçš„æ–‡æ¡£ï¼š{output_path}
  2. éªŒè¯ç«¯ç‚¹å®šä¹‰æ˜¯å¦å‡†ç¡®
  3. è¡¥å……ç¼ºå¤±çš„è¯·æ±‚/å“åº”ç±»å‹
  4. å°†éªŒè¯é€šè¿‡çš„ç«¯ç‚¹æ ‡è®°ä¸º [å·²éªŒè¯]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

## ç½®ä¿¡åº¦è¯´æ˜

```
ç½®ä¿¡åº¦è®¡ç®—è§„åˆ™ï¼š

é«˜ (â‰¥0.8)ï¼š
  - æœ‰ TypeScript ç±»å‹å®šä¹‰
  - æœ‰ Zod/Joi éªŒè¯ schema
  - æœ‰ JSDoc æ³¨é‡Š

ä¸­ (0.5-0.8)ï¼š
  - èƒ½æ¨æ–­å‚æ•°åå’ŒåŸºæœ¬ç±»å‹
  - ä½†ç¼ºå°‘å®Œæ•´ç±»å‹å®šä¹‰

ä½ (<0.5)ï¼š
  - åªèƒ½è¯†åˆ«è·¯ç”±è·¯å¾„å’Œæ–¹æ³•
  - å‚æ•°å’Œå“åº”ç±»å‹æœªçŸ¥
```

## é”™è¯¯å¤„ç†

```
å¦‚æœæ²¡æœ‰æ‰¾åˆ°è·¯ç”±æ–‡ä»¶ï¼š
  âŒ æœªæ‰¾åˆ°è·¯ç”±å®šä¹‰

  å·²æœç´¢çš„ä½ç½®ï¼š
  - src/routes/
  - src/router/
  - routes/

  å»ºè®®ï¼š
  1. ç¡®è®¤é¡¹ç›®åŒ…å« API ç«¯ç‚¹
  2. ä½¿ç”¨ --framework æŒ‡å®šæ¡†æ¶ç±»å‹
  3. æ‰‹åŠ¨åˆ›å»º 20_API_SPEC.md

å¦‚æœæ¡†æ¶ä¸æ”¯æŒï¼š
  âš ï¸ æ¡†æ¶ {framework} æš‚ä¸æ”¯æŒè‡ªåŠ¨é€†å‘

  å»ºè®®ï¼š
  1. æ‰‹åŠ¨åˆ›å»º API æ–‡æ¡£
  2. æˆ–æäº¤ Issue è¯·æ±‚æ”¯æŒ
```

## æ³¨æ„äº‹é¡¹

1. **åªè¯»æ“ä½œ**ï¼šä¸ä¼šä¿®æ”¹æºä»£ç 
2. **[é€†å‘] æ ‡è®°**ï¼šæ‰€æœ‰ç”Ÿæˆå†…å®¹éœ€äººå·¥éªŒè¯
3. **ä¸ä½œä¸º Gate ä¾æ®**ï¼šé€†å‘ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸èƒ½è‡ªåŠ¨é€šè¿‡ Gate
4. **éšç§ä¿æŠ¤**ï¼šä¸ä¼šè¯»å– .env æˆ–æ•æ„Ÿé…ç½®

## å…³è”å‘½ä»¤

- `/scan-project` - é¡¹ç›®æ‰«æ
- `/integrate-project` - é¡¹ç›®æ•´åˆ
- `/reverse-schema` - æ•°æ®æ¨¡å‹é€†å‘
- `/sync-docs` - æ£€æŸ¥æ–‡æ¡£ä¸ä»£ç ä¸€è‡´æ€§
